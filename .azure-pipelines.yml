# https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema
# https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/index

trigger:
  branches:
    include:
    - master

jobs:
- job: macOS

  pool:
    vmImage: 'macOS-10.13'

  steps:
  - checkout: self
    fetchDepth: 50
    submodules: false

  - script: |
      echo "Test jobs:"
      ./wpt test-jobs | while read job; do
        echo "$job"
        echo "##vso[task.setvariable variable=run_$job]true";
      done
    displayName: 'List test jobs'

  - script: |
      ./tools/ci/install.sh
    displayName: 'Install Safari Technology Preview'
    condition: variables.run_wptrunner_infrastructure

  - script: |
      no_proxy='*' ./wpt run --yes --manifest MANIFEST.json --metadata infrastructure/metadata/ --channel=preview safari_webdriver infrastructure/
    displayName: 'Run infrastructure/ tests'
    condition: variables.run_wptrunner_infrastructure
